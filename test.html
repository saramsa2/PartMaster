<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">

    <script src="js/aws-cognito-config.js"></script>
    <script src="js/aws-cognito-sdk.min.js"></script>
    <script src="js/amazon-cognito-identity.min.js"></script>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.7.20.min.js"></script>
</head>
<body>


  
  <label>username :</label>
  <input type="text" id="signin_username"><br>
  <label>email :</label> 
  <input type="text" id="signin_email"><br>
  <label>name :</label>
  <input type="text" id="signin_name"><br>
  <label>password :</label>
  <input type="password" id="signin_password"><br>
  <input type="button" value="sign up" onclick="submitSignUp">

  <script>
    debugger;
    // AWSCognito 객체를 계속해서 사용하는데 여기에 리전 정보를 저장합니다.
    // CognitoConfig.region이 위에서 별도의 js 파일에 넣어둔 설정값입니다.
    AWSCognito.config.region = CognitoConfig.region;

    // 사용할 User Pool의 정보를 담고있는 변수입니다.
    var poolData = {
      UserPoolId : CognitoConfig.userPoolId,
      ClientId : CognitoConfig.appClientId
    };

    // 입력한 User Pool 정보를 가지고 실제 User Pool에 접근할 수 있는 객체를 만듭니다.
    var userPool = new AWSCognito.CognitoIdentityServiceProvider.CognitoUserPool(poolData);

    // 아래 변수는 회원가입을 하고 가입이 성공했을 때 사용자 정보를 반환받는 변수인데,
    // 회원가입 함수와 인증 함수에서 같은 객체를 사용해야하기 때문에 전역변수로 뺐습니다.
    var cognitoUser;

    function submitSignUp() {
    // 가입할 때 사용자가 입력한 정보들을 저장할 배열입니다.
    var attributeList = [];
  
    // 입력 폼에서 입력된 값을 받아오는 부분입니다. 일반적인 javascript입니다.
    var user_username = document.getElementById("signin_username").value;
    var user_email = document.getElementById("signin_email").value;
    var user_name = document.getElementById("signin_name").value;
    var user_pwd = document.getElementById("signin_password").value;
    console.log('user data : ', user_username, ', ', user_email, ', ', user_pwd);
  
    // 이 변수가 사용자가 입력한 정보 중 하나를 입력하는 변수입니다.
    // 저는 핸드폰 번호만 입력받았습니다.
    // 변수명은 자유롭게 사용가능하나, Name은 AWS Cognito에서 정해주는대로 써야합니다.
    // 목록 : address, birthdate, email, family_name, gender, given_name, locale
    //   , middle_name, name, nickname, phone_number, picture, preferred_username
    //   , profile, timezone, updated_at, website
    var dataEmail = {
      Name: 'email',
      Value : user_email
    };

    var dataname = {
      Name: 'name',
      Value : user_name
    };
  
    // Attribute를 AWS Cognito가 알아들을 수 있는 객체로 만듭니다.
    var attributeEmail = new AWSCognito.CognitoIdentityServiceProvider.CognitoUserAttribute(dataEmail);
    var attributeName = new AWSCognito.CognitoIdentityServiceProvider.CognitoUserAttribute(dataname);
  
  
    // 방금 위에서 만든 Attribute 객체를 Attribute List에 추가시킵니다.
    // 이렇게 배열에 다 추가시키고 한번에 Cognito에 넘길겁니다.
    attributeList.push(attributeEmail);
    attributeList.push(attributeName);
  
    // 전역변수로 만들어 놓은 User Pool 객체에서는 signup 함수를 제공합니다.
    // 인자는 User name(ID 인것 같네요.), Password, Attribute List, null(무슨 자리인지 모르겠어요..확인해야합니다.ㅎㅎ), 처리 결과가 오면 수행 될 callback 함수 입니다.
    userPool.signUp(user_Name,user_Pw, attributeList, null, function(err, result) {
      if(err) {
        // error가 발생하면 여기로 빠집니다.
        alert(err);
        return;
      }
  
      // 가입이 성공하면 result에 가입된 User의 정보가 되돌아 옵니다.
      // 인증 함수에서 사용해야하기에 위에서 만든 전역변수인 cognitoUser에 넣어놓습니다.
      cognitoUser = result.user;
      console.log('user name is '+cognitoUser.getUsername());
    });
  }
  </script>
   


  


  
                <!-- ######    Read API   #####

    <input type="button" onclick="buyitems" value="Order Now">
    <p id="test_id"></p>    
    

    <script type="text/javascript">
        var apiUrl = 'https://hkrfhunj5a.execute-api.us-west-2.amazonaws.com/26-10-2022_v01/parts';
        fetch(apiUrl).then(response => {
          return response.json();
        }).then(data => {
          // Work with JSON data here
              
                var out ="<table class='table'><tr><th>Part ID</th><th>Name</th><th>Description</th><th>Price</th><th>Quantity</th></tr>";
                for(var i=0; i<data.length; i++) {                  
                  out += "<tr>";
                  out += "<td>" + data[i]["PartID"] + "</td>";
                  out += "<td>" + data[i]["PartName"] + "</td>";
                  out += "<td>" + data[i]["Description"] + "</td>";
                  out += "<td>" + data[i]["UnitPrice"] + "</td>";
                  out += "<td><input type='number' value='0' id='qty"+data[i]["PartID"] +"'></td>";                  
                  out += "</tr>";
                }
                out += "</table>";
          document.getElementById("test_id").innerHTML = out;
          console.log(data);

        }).catch(err => {
          // Do something for an error here
        });
    </script> -->

</body>
</html>